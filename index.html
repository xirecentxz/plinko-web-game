<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plinko Web Game</title>
    <style>
        body { margin: 0; background: #1a1a2e; color: #fff; overflow: hidden; font-family: 'Press Start 2P', cursive; /* Gaya font retro */ display: flex; justify-content: center; align-items: center; height: 100vh; touch-action: none; }
        
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap'); /* Import font dari Google Fonts */

        #game-container { position: relative; width: 400px; height: 600px; background: #2a2a4a; border: 4px solid #6a00ff; box-shadow: 0 0 30px rgba(106,0,255,0.7); overflow: hidden; }
        
        #ui { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-between; padding: 0 15px; box-sizing: border-box; z-index: 10; font-size: 16px; }
        #score-display { text-align: right; }
        #drop-button { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: #ffaa00; color: white; border: none; border-radius: 5px; cursor: pointer; font-family: 'Press Start 2P', cursive; font-size: 14px; z-index: 11; }
        #message { position: absolute; bottom: 10px; width: 100%; text-align: center; color: #00ffaa; font-size: 14px; z-index: 10; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui">
            <div>Credits: <span id="credits">1000</span></div>
            <div id="score-display">Win: <span id="winAmount">0</span></div>
        </div>
        <button id="drop-button">DROP BALL (10 Credits)</button>
        <div id="message"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        window.onload = () => {
            const { Engine, Render, Runner, Bodies, Composite, Events } = Matter;

            const container = document.getElementById('game-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const engine = Engine.create();
            const world = engine.world;
            world.gravity.y = 1; // Gravitasi normal

            let credits = 1000;
            let winAmount = 0;
            const dropCost = 10;
            let lastBall = null; // Untuk melacak bola yang baru jatuh

            const render = Render.create({
                element: container,
                engine: engine,
                options: { width, height, wireframes: false, background: 'transparent' }
            });

            // --- OBJEK PLINKO ---
            const wallOpt = { isStatic: true, render: { fillStyle: '#3a3a5a' }, restitution: 0.8 };
            const pegOpt = { isStatic: true, render: { fillStyle: '#884dff' }, restitution: 0.9, circleRadius: 5 }; // Pasak

            // Dinding Luar
            const walls = [
                Bodies.rectangle(width / 2, 5, width, 10, wallOpt), // Atas
                Bodies.rectangle(5, height / 2, 10, height, wallOpt), // Kiri
                Bodies.rectangle(width - 5, height / 2, 10, height, wallOpt), // Kanan
            ];

            // Pasak Piramida
            const pegs = [];
            const pegRadius = 5;
            const pegSpacingX = 30;
            const pegSpacingY = 25;
            const startY = 100;

            for (let row = 0; row < 12; row++) {
                const numPegs = row + 1;
                const rowWidth = numPegs * pegSpacingX;
                const startX = (width - rowWidth) / 2 + pegRadius;
                for (let i = 0; i < numPegs; i++) {
                    pegs.push(Bodies.circle(startX + i * pegSpacingX, startY + row * pegSpacingY, pegRadius, pegOpt));
                }
            }

            // Slot Skor di Bawah
            const slotValues = [10, 50, 100, 20, 5, 20, 100, 50, 10]; // Nilai untuk setiap slot
            const numSlots = slotValues.length;
            const slotWidth = width / numSlots;
            const slots = [];

            for (let i = 0; i < numSlots; i++) {
                const x = (i * slotWidth) + (slotWidth / 2);
                const value = slotValues[i];
                const color = i % 2 === 0 ? '#00ffaa' : '#ff5500'; // Warna bergantian

                // Sensor untuk deteksi bola masuk
                const sensor = Bodies.rectangle(x, height - 15, slotWidth - 5, 10, {
                    isStatic: true, isSensor: true, label: `slot-${value}`, render: { fillStyle: color, opacity: 0.3 }
                });
                slots.push(sensor);

                // Pembatas antar slot
                const divider = Bodies.rectangle(x + slotWidth / 2, height - 50, 5, 100, wallOpt);
                slots.push(divider);
            }

            Composite.add(world, [...walls, ...pegs, ...slots]);

            // --- FUNGSI JATUHKAN BOLA ---
            const dropBall = () => {
                if (credits < dropCost) {
                    document.getElementById('message').innerText = 'Not enough credits!';
                    return;
                }
                credits -= dropCost;
                document.getElementById('credits').innerText = credits;
                document.getElementById('message').innerText = ''; // Hapus pesan sebelumnya

                const ball = Bodies.circle(width / 2 + (Math.random() * 20 - 10), 50, 10, {
                    restitution: 0.8, // Pantulan
                    friction: 0.001, // Gesekan kecil
                    render: { fillStyle: '#ffdd00' }, // Warna bola
                    label: 'plinko-ball'
                });
                Composite.add(world, ball);
                lastBall = ball; // Tandai bola ini sebagai yang baru jatuh
            };

            document.getElementById('drop-button').addEventListener('click', dropBall);

            // --- DETEKSI SKOR ---
            Events.on(engine, 'collisionStart', (event) => {
                event.pairs.forEach(pair => {
                    const bodyA = pair.bodyA;
                    const bodyB = pair.bodyB;

                    // Pastikan yang bertabrakan adalah bola dan sensor slot
                    if ((bodyA.label === 'plinko-ball' && bodyB.label.startsWith('slot-')) ||
                        (bodyB.label === 'plinko-ball' && bodyA.label.startsWith('slot-'))) {
                        
                        const ball = bodyA.label === 'plinko-ball' ? bodyA : bodyB;
                        const slot = bodyA.label.startsWith('slot-') ? bodyA : bodyB;

                        // Pastikan ini adalah bola yang baru masuk slot, bukan bola lama yang mental lagi
                        if (ball === lastBall) {
                            const value = parseInt(slot.label.split('-')[1]);
                            winAmount += value;
                            credits += value;
                            document.getElementById('winAmount').innerText = winAmount;
                            document.getElementById('credits').innerText = credits;
                            document.getElementById('message').innerText = `You won ${value} credits!`;

                            // Hapus bola setelah mendapatkan skor
                            setTimeout(() => {
                                Composite.remove(world, ball);
                                lastBall = null; // Reset lastBall
                            }, 500); // Beri waktu sebentar agar terlihat masuk
                        }
                    }
                });
            });

            // --- RUN GAME ---
            Render.run(render);
            Runner.run(Runner.create(), engine);
        };
    </script>
</body>
</html>
