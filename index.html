<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plinko Web Game - Pro Version</title>
    <style>
        body { margin: 0; background: #0f0f1b; color: #fff; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; touch-action: none; }
        
        #game-container { position: relative; width: 400px; height: 700px; background: #1a1a2e; border: 3px solid #4e4e91; box-shadow: 0 0 20px rgba(78, 78, 145, 0.5); overflow: hidden; display: flex; flex-direction: column; }
        
        #ui-top { position: absolute; top: 0; width: 100%; display: flex; justify-content: space-between; padding: 10px 15px; box-sizing: border-box; z-index: 10; background: rgba(26, 26, 46, 0.8); border-bottom: 1px solid #333; }
        
        /* Area Tombol di Bawah */
        #controls-bottom { position: absolute; bottom: 0; width: 100%; height: 80px; background: #1a1a2e; display: flex; justify-content: center; align-items: center; border-top: 2px solid #4e4e91; z-index: 20; }
        
        #drop-button { padding: 12px 24px; background: #ffaa00; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.1s, background 0.2s; box-shadow: 0 4px 0 #cc8800; }
        #drop-button:active { transform: translateY(3px); box-shadow: 0 1px 0 #cc8800; background: #ffbb33; }
        
        #message { position: absolute; bottom: 90px; width: 100%; text-align: center; color: #00ffaa; font-weight: bold; font-size: 14px; z-index: 10; text-shadow: 0 0 5px #000; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui-top">
            <div>CREDITS: <span id="credits" style="color:#ffaa00">1000</span></div>
            <div>WIN: <span id="winAmount" style="color:#00ffaa">0</span></div>
        </div>

        <div id="message"></div>

        <div id="controls-bottom">
            <button id="drop-button">DROP BALL (10 Credits)</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        window.onload = () => {
            const { Engine, Render, Runner, Bodies, Composite, Events, Body } = Matter;

            const container = document.getElementById('game-container');
            const width = 400;
            const height = 620; // Mengurangi tinggi kanvas agar sisa untuk tombol bawah

            const engine = Engine.create();
            const world = engine.world;
            world.gravity.y = 1.2; 

            let credits = 1000;
            let winAmount = 0;
            const dropCost = 10;

            const render = Render.create({
                element: container,
                engine: engine,
                options: { width, height, wireframes: false, background: 'transparent' }
            });

            const wallOpt = { isStatic: true, render: { fillStyle: '#252545' }, restitution: 0.5 };
            const pegOpt = { isStatic: true, render: { fillStyle: '#884dff' }, restitution: 0.8 };

            // 1. Dinding Samping yang rapat
            Composite.add(world, [
                Bodies.rectangle(5, height / 2, 10, height, wallOpt), // Kiri
                Bodies.rectangle(width - 5, height / 2, 10, height, wallOpt) // Kanan
            ]);

            // 2. Pasak Lebih Banyak (Memenuhi Lebar)
            // Menambah jumlah baris menjadi 14 agar menyentuh sisi kanan-kiri
            const rows = 14;
            const pegRadius = 4;
            for (let row = 0; row < rows; row++) {
                const numPegs = row + 3; // Mulai dari 3 pasak di baris pertama
                const spacingX = width / (numPegs + 1);
                for (let i = 0; i < numPegs; i++) {
                    const x = spacingX * (i + 1);
                    const y = 80 + (row * 32);
                    Composite.add(world, Bodies.circle(x, y, pegRadius, pegOpt));
                }
            }

            // 3. Slot Skor (Multiplier)
            const slotValues = [5, 10, 50, 100, 200, 100, 50, 10, 5];
            const numSlots = slotValues.length;
            const slotWidth = (width - 20) / numSlots;
            
            for (let i = 0; i < numSlots; i++) {
                const x = 10 + (i * slotWidth) + (slotWidth / 2);
                const val = slotValues[i];
                
                // Sensor deteksi
                const sensor = Bodies.rectangle(x, height - 20, slotWidth - 4, 15, {
                    isStatic: true, isSensor: true, label: `slot-${val}`,
                    render: { fillStyle: i % 2 === 0 ? '#ff5500' : '#00ffaa', opacity: 0.5 }
                });
                
                // Pembatas antar slot
                const divider = Bodies.rectangle(x + slotWidth / 2, height - 50, 4, 100, wallOpt);
                Composite.add(world, [sensor, divider]);
            }

            // 4. Logika Drop
            const dropBall = () => {
                if (credits < dropCost) {
                    document.getElementById('message').innerText = 'KREDIT HABIS!';
                    return;
                }
                credits -= dropCost;
                document.getElementById('credits').innerText = credits;
                document.getElementById('message').innerText = '';

                // Bola muncul acak sedikit di tengah atas
                const ball = Bodies.circle(width/2 + (Math.random() * 40 - 20), 40, 9, {
                    restitution: 0.6, friction: 0.005,
                    render: { fillStyle: '#ffaa00' }, label: 'ball'
                });
                Composite.add(world, ball);
            };

            document.getElementById('drop-button').addEventListener('click', dropBall);

            // 5. Deteksi Menang
            Events.on(engine, 'collisionStart', (event) => {
                event.pairs.forEach(pair => {
                    const { bodyA, bodyB } = pair;
                    const ball = bodyA.label === 'ball' ? bodyA : (bodyB.label === 'ball' ? bodyB : null);
                    const slot = bodyA.label.startsWith('slot-') ? bodyA : (bodyB.label.startsWith('slot-') ? bodyB : null);

                    if (ball && slot) {
                        const val = parseInt(slot.label.split('-')[1]);
                        winAmount += val;
                        credits += val;
                        document.getElementById('winAmount').innerText = winAmount;
                        document.getElementById('credits').innerText = credits;
                        document.getElementById('message').innerText = `DAPAT ${val} KREDIT!`;
                        
                        // Efek hapus bola
                        setTimeout(() => Composite.remove(world, ball), 300);
                    }
                });
            });

            Render.run(render);
            const runner = Runner.create();
            Runner.run(runner, engine);
        };
    </script>
</body>
</html>
